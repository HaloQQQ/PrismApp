<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:MusicPlayerModule.Converters">
    <converters:MusicDistributeMultiConverter x:Key="MusicDistributeMultiConverter" />

    <converters:BatchAddAndPlayModelConverter x:Key="BatchAddAndPlayModelConverter" />

    <Style
        x:Key="Love"
        BasedOn="{StaticResource ToggleButton_Icon_Fill}"
        TargetType="ToggleButton">
        <Setter Property="MyAttachProperty.SelectedForeground" Value="{StaticResource OrangeRed}" />

        <Setter Property="Content" Value="&#xe644;" />
        <Setter Property="ToolTip" Value="收藏" />

        <Style.Triggers>
            <Trigger Property="IsChecked" Value="True">
                <Setter Property="Content" Value="&#xe684;" />
                <Setter Property="ToolTip" Value="取消收藏" />
            </Trigger>
        </Style.Triggers>
    </Style>

    <ContextMenu x:Key="MusicDir_CRUD" MyAttachProperty.IsCollapsed="True">
        <MenuItem
            Command="{Binding OpenInExploreCommand}"
            CommandParameter="{Binding PlacementTarget.SelectedItem.ClassifyKey, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            Header="打开目录位置"
            Icon="&#xebdf;" />
        <MenuItem
            Command="{Binding DistributeMusicViewModel.AddMusicDirCommand}"
            Header="新增目录"
            Icon="&#xe622;" />
        <MenuItem
            Command="{Binding DistributeMusicViewModel.BatchMoveMusicDirCommand}"
            CommandParameter="{Binding PlacementTarget.SelectedItem.ClassifyKey, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            Header="移动内容"
            Icon="&#xe64f;" />
        <MenuItem
            Command="{Binding DistributeMusicViewModel.RemoveMusicDirCommand}"
            CommandParameter="{Binding PlacementTarget.SelectedItem.ClassifyKey, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            Header="移除目录"
            Icon="&#xec7b;" />
        <MenuItem
            Command="{Binding DistributeMusicViewModel.RenameMusicDirCommand}"
            CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            Header="修改目录名"
            Icon="&#xe654;" />
        <MenuItem
            Command="{Binding AddToPlayingCommand}"
            CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            Header="添加到播放队列"
            Icon="&#xe704;" />
    </ContextMenu>

    <ContextMenu x:Key="FavoriteDataGridContextMenu" MyAttachProperty.IsCollapsed="True">
        <MenuItem
            Command="{Binding PlacementTarget.DataContext.PlayFavoriteCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            Header="播放"
            Icon="&#xea6d;" />

        <MenuItem
            Command="{Binding PlacementTarget.DataContext.AddNextCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            Header="下一首播放"
            Icon="&#xe704;" />

        <MenuItem
            Command="{Binding PlacementTarget.DataContext.OpenInExploreCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            CommandParameter="{Binding PlacementTarget.SelectedItem.Music.FileDir, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            Header="打开目录位置"
            Icon="&#xebdf;" />

        <MenuItem
            Command="{Binding PlacementTarget.DataContext.DownLoadCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            CommandParameter="{Binding PlacementTarget.SelectedItem.Music, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            Header="下载"
            Icon="&#xe63b;" />

        <MenuItem
            Command="{Binding PlacementTarget.DataContext.DistributeMusicViewModel.DeleteFavoriteCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
            Header="从列表删除"
            Icon="&#xec7b;" />

        <MenuItem
            Header="添加到"
            Icon="&#xe663;"
            ItemsSource="{Binding PlacementTarget.DataContext.DistributeMusicViewModel.MusicDirs, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
            <MenuItem.ItemContainerStyle>
                <Style BasedOn="{StaticResource {x:Type MenuItem}}" TargetType="MenuItem">
                    <Setter Property="Header" Value="{Binding DirName}" />
                    <Setter Property="Command" Value="{Binding PlacementTarget.DataContext.DistributeMusicViewModel.DistributeToCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />

                    <Setter Property="CommandParameter">
                        <Setter.Value>
                            <MultiBinding Converter="{StaticResource MusicDistributeMultiConverter}">
                                <MultiBinding.Bindings>
                                    <Binding Path="PlacementTarget.SelectedItem.Music" RelativeSource="{RelativeSource AncestorType=ContextMenu}" />
                                    <Binding Path="DirPath" />
                                </MultiBinding.Bindings>
                            </MultiBinding>
                        </Setter.Value>
                    </Setter>

                    <Style.Triggers>
                        <DataTrigger Value="True">
                            <DataTrigger.Binding>
                                <MultiBinding Converter="{StaticResource MultiConverter_IsStringEquals}">
                                    <MultiBinding.Bindings>
                                        <Binding Path="PlacementTarget.SelectedItem.Music.FileDir" RelativeSource="{RelativeSource AncestorType=ContextMenu}" />
                                        <Binding Path="DirPath" />
                                    </MultiBinding.Bindings>
                                </MultiBinding>
                            </DataTrigger.Binding>
                            <Setter Property="IsEnabled" Value="False" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </MenuItem.ItemContainerStyle>
        </MenuItem>
    </ContextMenu>

    <Style
        x:Key="FavoriteDataGridFirstColumnHeaderStyle"
        BasedOn="{StaticResource {x:Type DataGridColumnHeader}}"
        TargetType="DataGridColumnHeader">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="DataGridColumnHeader">
                    <Grid Margin="10,0,0,0">
                        <TextBlock Style="{StaticResource TextBlock_NotImportant_White}" Visibility="{Binding DataContext.DistributeMusicViewModel.CanBatchSelect, RelativeSource={RelativeSource AncestorType=DataGrid}, Converter={StaticResource BoolToVisibleCollapsedConverter}}">
                            <TextBlock Text="已选" />
                            <TextBlock Text="{Binding DataContext.DistributeMusicViewModel.SelectedCount, RelativeSource={RelativeSource AncestorType=DataGrid}}" />
                            <TextBlock Text="首" />
                        </TextBlock>

                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="音乐名" />
                            <TextBlock Style="{StaticResource TextBlock_DataGridColumnHeader_SortIcon}" />

                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible" />

                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DataContext.DistributeMusicViewModel.CanBatchSelect, RelativeSource={RelativeSource AncestorType=DataGrid}}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <DataTemplate x:Key="FavoriteDataGridFirstColumnCellTemplate">
        <DockPanel Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=DataGridCell}}" HorizontalAlignment="Stretch">
            <StackPanel
                Margin="0,0,15,0"
                DockPanel.Dock="Right"
                Orientation="Horizontal">
                <Button
                    Command="{Binding DataContext.PlayFavoriteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                    CommandParameter="{Binding}"
                    Content="&#xea6d;"
                    Style="{StaticResource ButtonBase_Icon_Small_HoverBlue}"
                    ToolTip="播放当前" />
                <Button
                    Command="{Binding DataContext.AddNextCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                    CommandParameter="{Binding}"
                    Content="&#xe704;"
                    Style="{StaticResource ButtonBase_Icon_Small_HoverBlue}"
                    ToolTip="下一首播放" />
                <Button
                    Command="{Binding DataContext.DownLoadCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                    CommandParameter="{Binding Music}"
                    Content="&#xe63b;"
                    Style="{StaticResource ButtonBase_Icon_Small_HoverBlue}"
                    ToolTip="下载" />
                <Button
                    Content="&#xe682;"
                    MyAttachProperty.HasContextMenu="True"
                    Style="{StaticResource ButtonBase_Icon_Small_HoverBlue}"
                    Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                    ToolTip="更多">
                    <Button.ContextMenu>
                        <ContextMenu MyAttachProperty.IsCollapsed="True">
                            <MenuItem
                                Command="{Binding PlacementTarget.Tag.PlayFavoriteCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                CommandParameter="{Binding DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                Header="播放"
                                Icon="&#xea6d;" />

                            <MenuItem
                                Command="{Binding PlacementTarget.Tag.AddNextCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                Header="下一首播放"
                                Icon="&#xe704;" />

                            <MenuItem
                                Command="{Binding PlacementTarget.Tag.OpenInExploreCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                CommandParameter="{Binding PlacementTarget.DataContext.Music.FileDir, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                Header="打开目录位置"
                                Icon="&#xebdf;" />

                            <MenuItem
                                Command="{Binding PlacementTarget.Tag.DownLoadCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                CommandParameter="{Binding PlacementTarget.DataContext.Music, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                Header="下载"
                                Icon="&#xe63b;" />

                            <MenuItem
                                Command="{Binding PlacementTarget.Tag.DistributeMusicViewModel.DeleteFavoriteCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                Header="从列表删除"
                                Icon="&#xec7b;" />

                            <MenuItem
                                Header="添加到"
                                Icon="&#xe663;"
                                ItemsSource="{Binding PlacementTarget.Tag.DistributeMusicViewModel.MusicDirs, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                                <MenuItem.ItemContainerStyle>
                                    <Style BasedOn="{StaticResource {x:Type MenuItem}}" TargetType="MenuItem">
                                        <Setter Property="Header" Value="{Binding DirName}" />
                                        <Setter Property="Command" Value="{Binding PlacementTarget.Tag.DistributeMusicViewModel.DistributeToCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                                        <Setter Property="CommandParameter">
                                            <Setter.Value>
                                                <MultiBinding Converter="{StaticResource MusicDistributeMultiConverter}">
                                                    <MultiBinding.Bindings>
                                                        <Binding Path="PlacementTarget.DataContext.Music" RelativeSource="{RelativeSource AncestorType=ContextMenu}" />
                                                        <Binding Path="DirPath" />
                                                    </MultiBinding.Bindings>
                                                </MultiBinding>
                                            </Setter.Value>
                                        </Setter>

                                        <Style.Triggers>
                                            <DataTrigger Value="True">
                                                <DataTrigger.Binding>
                                                    <MultiBinding Converter="{StaticResource MultiConverter_IsStringEquals}">
                                                        <MultiBinding.Bindings>
                                                            <Binding Path="PlacementTarget.DataContext.Music.FileDir" RelativeSource="{RelativeSource AncestorType=ContextMenu}" />
                                                            <Binding Path="DirPath" />
                                                        </MultiBinding.Bindings>
                                                    </MultiBinding>
                                                </DataTrigger.Binding>
                                                <Setter Property="IsEnabled" Value="False" />
                                            </DataTrigger>
                                        </Style.Triggers>

                                    </Style>
                                </MenuItem.ItemContainerStyle>
                            </MenuItem>
                        </ContextMenu>
                    </Button.ContextMenu>
                </Button>

                <StackPanel.Style>
                    <Style TargetType="StackPanel">
                        <Setter Property="Visibility" Value="Collapsed" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=DataGridRow}}" Value="True">
                                <Setter Property="Visibility" Value="Visible" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </StackPanel.Style>
            </StackPanel>

            <ToggleButton DockPanel.Dock="Left" Style="{StaticResource Love}" />

            <TextBlock
                DockPanel.Dock="Left"
                Text="{Binding Music.Name}"
                ToolTip="{Binding Music.Name}" />
        </DockPanel>
    </DataTemplate>

    <Style
        x:Key="DefaultSingerBack"
        BasedOn="{StaticResource TextBlock_Theme_Icon_MouseOver}"
        TargetType="TextBlock">
        <Setter Property="Background" Value="White" />
        <Setter Property="Foreground" Value="{StaticResource DeepGray}" />

        <Setter Property="Width" Value="60" />
        <Setter Property="Height" Value="60" />

        <Setter Property="FontSize" Value="40" />

        <Setter Property="Text" Value="&#xe61c;" />

        <Setter Property="Padding" Value="0,10" />

        <Setter Property="TextAlignment" Value="Center" />

        <Setter Property="Clip">
            <Setter.Value>
                <EllipseGeometry
                    Center="30,30"
                    RadiusX="30"
                    RadiusY="30" />
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>