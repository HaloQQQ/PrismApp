<UserControl
    x:Class="MyApp.Prisms.Views.SettingsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:appHotKey="http://IceTea.Wpf.Atom.AppHotKey.com/"
    xmlns:globalHotKey="clr-namespace:IceTea.Atom.Utils.HotKey.Global;assembly=IceTea.Atom"
    xmlns:globalHotKeyContracts="clr-namespace:IceTea.Atom.Utils.HotKey.Global.Contracts;assembly=IceTea.Atom"
    xmlns:models="clr-namespace:PrismAppBasicLib.Models;assembly=PrismAppBasicLib"
    xmlns:prism="http://prismlibrary.com/"
    xmlns:viewModels="clr-namespace:MyApp.Prisms.ViewModels"
    MinWidth="800"
    MaxHeight="500"
    prism:ViewModelLocator.AutoWireViewModel="True">
    <UserControl.Resources>
        <ObjectDataProvider
            x:Key="CustomKeys"
            MethodName="GetNames"
            ObjectType="{x:Type globalHotKeyContracts:CustomKeys}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="globalHotKeyContracts:CustomKeys" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <ObjectDataProvider
            x:Key="AppHotKeys"
            MethodName="GetNames"
            ObjectType="{x:Type Key}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="Key" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <DataTemplate DataType="{x:Type appHotKey:AppConfigFileHotKeyGroup}">
            <GroupBox Header="{Binding GroupName}">
                <StackPanel>
                    <TextBlock Text="{Binding Description}" />

                    <Button
                        Margin="0,10,20,0"
                        HorizontalAlignment="Right"
                        Command="{Binding DataContext.ResetAppHotKeyGroupCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                        CommandParameter="{Binding}"
                        Content="&#xe614;"
                        Style="{StaticResource ButtonBase_Icon_ScaleUp}"
                        ToolTip="重置快捷键" />

                    <ListBox
                        HorizontalAlignment="Stretch"
                        ItemContainerStyle="{StaticResource ListBoxItem_General}"
                        ItemsSource="{Binding}" />
                </StackPanel>
            </GroupBox>
        </DataTemplate>

        <DataTemplate DataType="{x:Type appHotKey:AppHotKey}">
            <StackPanel MinHeight="40" Orientation="Horizontal">
                <TextBlock
                    MinWidth="110"
                    FontSize="16"
                    TextAlignment="Right">
                    <TextBlock Text="{Binding Name}" />
                    :
                </TextBlock>

                <CheckBox
                    Margin="10,0,0,0"
                    Content="Ctrl:"
                    IsChecked="{Binding IsSelectCtrl}"
                    IsEnabled="{Binding IsUsable}" />

                <CheckBox
                    Margin="10,0,0,0"
                    Content="Shift:"
                    IsChecked="{Binding IsSelectShift}"
                    IsEnabled="{Binding IsUsable}" />

                <CheckBox
                    Margin="10,0,0,0"
                    Content="Alt:"
                    IsChecked="{Binding IsSelectAlt}"
                    IsEnabled="{Binding IsUsable}" />

                <ComboBox
                    MaxWidth="120"
                    Margin="10,0,0,0"
                    IsEnabled="{Binding IsUsable}"
                    IsReadOnly="True"
                    ItemsSource="{Binding Source={StaticResource AppHotKeys}}"
                    SelectedValue="{Binding SelectedKey, Converter={StaticResource Key2StringConverter}}" />

                <TextBox
                    MinWidth="170"
                    IsEnabled="{Binding IsUsable}"
                    IsReadOnly="True"
                    KeyUp="AppHotKeyTextBox_OnKeyUp"
                    Text="{Binding CombineKeys, Mode=OneWay}">
                    <TextBox.Style>
                        <Style BasedOn="{StaticResource {x:Type TextBox}}" TargetType="TextBox">
                            <Setter Property="MyAttachProperty.PlaceHolder" Value="组合键" />

                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsUsable}" Value="False">
                                    <Setter Property="Foreground" Value="Red" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <CheckBox IsChecked="{Binding IsUsable}" Style="{StaticResource CheckBox_Switch}" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type globalHotKey:GlobalConfigFileHotKeyGroup}">
            <GroupBox Header="{Binding GroupName}">
                <StackPanel>
                    <TextBlock Text="{Binding Description}" />

                    <Button
                        Margin="0,10,20,0"
                        HorizontalAlignment="Right"
                        Command="{Binding DataContext.ResetGlobalHotKeyGroupCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                        CommandParameter="{Binding}"
                        Content="&#xe614;"
                        Style="{StaticResource ButtonBase_Icon_ScaleUp}"
                        ToolTip="重置快捷键" />

                    <ListBox
                        HorizontalAlignment="Stretch"
                        ItemContainerStyle="{StaticResource ListBoxItem_General}"
                        ItemsSource="{Binding}" />

                    <DockPanel LastChildFill="False">
                        <Button
                            Margin="20,10"
                            Command="{Binding DataContext.CancelCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                            CommandParameter="{Binding}"
                            Content="取消"
                            DockPanel.Dock="Right"
                            Style="{StaticResource ButtonBase_Icon_Conent_Transparent}" />
                        <Button
                            Margin="20,10"
                            Command="{Binding DataContext.SubmitCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                            CommandParameter="{Binding}"
                            Content="确认"
                            DockPanel.Dock="Right"
                            Style="{StaticResource ButtonBase_Icon_Conent_Transparent}" />
                    </DockPanel>
                </StackPanel>
            </GroupBox>
        </DataTemplate>

        <DataTemplate DataType="{x:Type globalHotKey:GlobalHotKey}">
            <StackPanel MinHeight="40" Orientation="Horizontal">
                <TextBlock
                    MinWidth="110"
                    FontSize="16"
                    TextAlignment="Right">
                    <TextBlock Text="{Binding Name}" />
                    :
                </TextBlock>

                <CheckBox
                    Margin="10,0,0,0"
                    Content="Ctrl:"
                    IsChecked="{Binding IsSelectCtrl}"
                    IsEnabled="{Binding IsUsable}" />

                <CheckBox
                    Margin="10,0,0,0"
                    Content="Shift:"
                    IsChecked="{Binding IsSelectShift}"
                    IsEnabled="{Binding IsUsable}" />

                <CheckBox
                    Margin="10,0,0,0"
                    Content="Alt:"
                    IsChecked="{Binding IsSelectAlt}"
                    IsEnabled="{Binding IsUsable}" />

                <ComboBox
                    MaxWidth="120"
                    Margin="10,0,0,0"
                    IsEnabled="{Binding IsUsable}"
                    IsReadOnly="True"
                    ItemsSource="{Binding Source={StaticResource CustomKeys}}"
                    Text="{Binding SelectedKey}" />

                <TextBox
                    MinWidth="170"
                    IsEnabled="{Binding IsUsable}"
                    IsReadOnly="True"
                    KeyUp="GlobalHotKeyTextBox_OnKeyUp"
                    Text="{Binding CombineKeys, Mode=OneWay}">
                    <TextBox.Style>
                        <Style BasedOn="{StaticResource {x:Type TextBox}}" TargetType="TextBox">
                            <Setter Property="MyAttachProperty.PlaceHolder" Value="组合键" />

                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsUsable}" Value="False">
                                    <Setter Property="Foreground" Value="Red" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <CheckBox IsChecked="{Binding IsUsable}" Style="{StaticResource CheckBox_Switch}" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewModels:Pair}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Style="{StaticResource TextBlock_Theme}" Text="邮箱:" />
                <TextBox
                    Width="250"
                    IsReadOnly="True"
                    Text="{Binding Key}" />
                <TextBlock Style="{StaticResource TextBlock_Theme}" Text="授权码:" />
                <PasswordBox
                    Width="250"
                    MyAttachProperty.IsReadOnly="True"
                    MyAttachProperty.Password="{Binding Value}" />
                <Button
                    Command="{Binding DataContext.RemoveMailAccountCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                    CommandParameter="{Binding}"
                    Content="&#xe60a;"
                    FontSize="30"
                    Style="{StaticResource ButtonBase_Icon_ScaleDown_Small_HoverBlue}" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type models:SettingModel}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Style="{StaticResource TextBlock_Theme}" Text="{Binding Name}" />
                <TextBox
                    Width="500"
                    IsReadOnly="True"
                    MyAttachProperty.PlaceHolder="空目录"
                    Text="{Binding Value, Mode=OneWay}" />
                <Button
                    Command="{Binding OpenFolderCommand}"
                    Content="浏览"
                    MyAttachProperty.IconFontText="&#xebdf;"
                    Style="{StaticResource ButtonBase_Icon_Conent_Transparent}" />
            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>

    <Border
        Padding="0,10"
        Background="LightBlue"
        CornerRadius="20">
        <TabControl ItemContainerStyle="{StaticResource TabItem_Transparent}" Style="{StaticResource TabControl_ScrollContent}">
            <TabItem Header="默认目录">
                <ListBox
                    HorizontalContentAlignment="Left"
                    ItemContainerStyle="{StaticResource ListBoxItem_General}"
                    ItemsSource="{Binding DataContext.SettingModels.Values, RelativeSource={RelativeSource AncestorType=TabControl}}" />
            </TabItem>
            <TabItem Header="默认邮箱">
                <StackPanel>
                    <StackPanel Margin="2,0,0,0" Orientation="Horizontal">
                        <TextBlock Style="{StaticResource TextBlock_Theme}" Text="邮箱:" />
                        <TextBox
                            Width="250"
                            MyAttachProperty.PlaceHolder="邮箱"
                            Text="{Binding DataContext.CurrentMailPair.Key, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType=TabControl}}" />
                        <TextBlock Style="{StaticResource TextBlock_Theme}" Text="授权码:" />
                        <PasswordBox
                            Width="250"
                            MyAttachProperty.Password="{Binding DataContext.CurrentMailPair.Value, Mode=TwoWay, RelativeSource={RelativeSource AncestorType=TabControl}}"
                            MyAttachProperty.PlaceHolder="授权码" />

                        <Button
                            Command="{Binding DataContext.AddMailAccountCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                            Content="&#xe622;"
                            FontSize="30"
                            Style="{StaticResource ButtonBase_Icon_ScaleDown_Small_HoverBlue}" />
                    </StackPanel>
                    <ListBox
                        HorizontalContentAlignment="Left"
                        ItemContainerStyle="{StaticResource ListBoxItem_General}"
                        ItemsSource="{Binding DataContext.MailAccounts, RelativeSource={RelativeSource AncestorType=TabControl}}" />
                </StackPanel>
            </TabItem>
            <TabItem Header="全局快捷键">
                <ListBox ItemContainerStyle="{StaticResource ListBoxItem_General}" ItemsSource="{Binding DataContext.GlobaConfigFilelHotKeyManager, RelativeSource={RelativeSource AncestorType=TabControl}}" />
            </TabItem>
            <TabItem Header="应用快捷键">
                <ListBox ItemContainerStyle="{StaticResource ListBoxItem_General}" ItemsSource="{Binding DataContext.AppConfigFileHotKeyManager, RelativeSource={RelativeSource AncestorType=TabControl}}" />
            </TabItem>
            <TabItem Header="小游戏">
                <WrapPanel>
                    <Button
                        Command="{Binding DataContext.SmallGameCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                        CommandParameter="_2048"
                        Content="2048"
                        Style="{StaticResource ButtonBase_Icon_Conent_Transparent}" />

                    <Button
                        Command="{Binding DataContext.SmallGameCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                        CommandParameter="五子棋"
                        Content="五子棋"
                        Style="{StaticResource ButtonBase_Icon_Conent_Transparent}" />

                    <Button
                        Command="{Binding DataContext.SmallGameCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                        CommandParameter="象棋"
                        Content="象棋"
                        Style="{StaticResource ButtonBase_Icon_Conent_Transparent}" />

                    <Button
                        Command="{Binding DataContext.ColorPickerCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                        Content="颜色选择器"
                        Style="{StaticResource ButtonBase_Icon_Conent_Transparent}" />
                </WrapPanel>
            </TabItem>
            <TabItem Header="设置">
                <StackPanel>
                    <WrapPanel>
                        <TextBlock Style="{StaticResource TextBlock_Theme}" Text="窗口圆角：" />
                        <Slider
                            Width="630"
                            Height="4"
                            Maximum="20"
                            Minimum="0"
                            Style="{StaticResource Slider_ObviousThumb}"
                            TickFrequency="5"
                            Value="{Binding DataContext.CornerRadius, Converter={StaticResource CornerRadiusToDigitConverter}, ConverterParameter=1, RelativeSource={RelativeSource AncestorType=TabControl}}" />
                    </WrapPanel>

                    <WrapPanel>
                        <Button
                            Command="{Binding DataContext.CleanConfigWhenExitAppCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                            Content="清空配置"
                            MyAttachProperty.IconFontText="&#xec7b;"
                            Style="{StaticResource ButtonBase_Icon_Conent_Transparent}"
                            ToolTip="关闭程序时清空所有配置" />
                        <Button
                            Command="{Binding DataContext.RestartComputerCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                            Content="重启电脑"
                            MyAttachProperty.IconFontText="&#xe63e;"
                            Style="{StaticResource ButtonBase_Icon_Conent_Transparent}" />
                        <Button
                            Command="{Binding DataContext.ShutdownComputerCommand, RelativeSource={RelativeSource AncestorType=TabControl}}"
                            Content="关闭电脑"
                            MyAttachProperty.IconFontText="&#xe605;"
                            Style="{StaticResource ButtonBase_Icon_Conent_Transparent}" />
                    </WrapPanel>
                </StackPanel>
            </TabItem>
        </TabControl>
    </Border>
</UserControl>